# [TASK-002] ProfileService PDF 解析优化

> **状态**: 🟡 待分配
>
> **负责人**: 待分配
>
> **预计工时**: 6 小时
>
> **优先级**: P2 中

---

## 1. 任务描述

### 背景

当前 PDF 解析对某些格式支持不佳，需要增强健壮性：
- 处理扫描版 PDF（图片形式）
- 处理多列布局
- 处理特殊字符编码

### 目标

- 提高 PDF 解析成功率
- 添加解析失败的友好错误提示
- 支持更多 PDF 格式

### 范围

- ✅ 包含: `ProfileService.extract_text_from_pdf()` 和 `ProfileService.extract_from_pdf()`
- ❌ 不包含: 其他文档格式（Word, TXT）

---

## 2. 技术规格

### 涉及文件

| 文件 | 操作 | 说明 |
|------|------|------|
| `src/services/profile_service.py` | 修改 | 增强 PDF 解析 |
| `tests/test_profile_service.py` | 新增 | PDF 解析测试 |
| `tests/fixtures/` | 新增 | 测试用 PDF 文件 |

### 接口定义

```python
def extract_text_from_pdf(self, pdf_path: Path) -> str:
    """
    从 PDF 文件提取文本。
    
    增强功能:
    - 自动检测 PDF 类型（文本/扫描）
    - 多列布局智能合并
    - 特殊字符标准化
    
    Args:
        pdf_path: PDF 文件路径
    
    Returns:
        str: 提取的文本内容
    
    Raises:
        ProfileServiceError: 
            - PDF 文件不存在
            - PDF 格式无法解析
            - 提取的文本为空
    """
    pass
```

### 依赖关系

- 依赖: `PyPDF2` (已存在)
- 可选依赖: `pdfplumber` (更好的表格/多列支持)

---

## 3. 验收标准

### 功能测试

- [ ] 正常 PDF: 文本型 PDF 正确提取
- [ ] 多列 PDF: 两列布局正确合并
- [ ] 空 PDF: 抛出友好错误
- [ ] 损坏 PDF: 抛出友好错误

### 代码质量

- [ ] 错误信息清晰，便于用户理解
- [ ] 类型标注完整
- [ ] 测试覆盖率 > 80%

### 文档

- [ ] 更新本任务文档
- [ ] PR 描述包含测试 PDF 样例说明

---

## 4. 设计方案 (实习生填写)

### 实现思路

> 在这里描述你打算如何实现...

### 关键决策

> 列出任何需要做的技术选择...

### Senior 审批

- [ ] 设计方案已审批 (Senior 签名: _______  日期: _______ )

---

## 5. 实现记录 (实习生填写)

### 开发日志

| 日期 | 进度 | 备注 |
|------|------|------|

### 遇到的问题

（开发过程中记录）

### PR 链接

- PR #XX: [标题](链接)

---

## 6. Review 记录 (Senior 填写)

### 代码审查

- [ ] 代码符合规范
- [ ] 测试充分
- [ ] 无安全风险

### 反馈

> Senior 的修改建议...

### 最终审批

- [ ] ✅ 已合并 (日期: _______) 
- [ ] ❌ 需要返工 (原因: _______)
