# [TASK-001] EmailService æ·»åŠ é‡è¯•æœºåˆ¶

> **çŠ¶æ€**: ğŸŸ¡ å¾…åˆ†é…
>
> **è´Ÿè´£äºº**: å¾…åˆ†é…
>
> **é¢„è®¡å·¥æ—¶**: 4 å°æ—¶
>
> **ä¼˜å…ˆçº§**: P2 ä¸­

---

## 1. ä»»åŠ¡æè¿°

### èƒŒæ™¯

å½“å‰ `EmailService` è°ƒç”¨ LLM æ—¶ï¼Œå¦‚æœé‡åˆ°ä¸´æ—¶æ€§ç½‘ç»œé”™è¯¯æˆ– API é™æµï¼Œä¼šç›´æ¥å¤±è´¥ã€‚éœ€è¦æ·»åŠ è‡ªåŠ¨é‡è¯•æœºåˆ¶æé«˜ç¨³å®šæ€§ã€‚

### ç›®æ ‡

- LLM è°ƒç”¨å¤±è´¥æ—¶è‡ªåŠ¨é‡è¯•
- æ”¯æŒé…ç½®é‡è¯•æ¬¡æ•°å’Œé—´éš”
- è®°å½•é‡è¯•æ—¥å¿—

### èŒƒå›´

- âœ… åŒ…å«: `EmailService.generate()` å’Œ `EmailService.regenerate()` çš„é‡è¯•é€»è¾‘
- âŒ ä¸åŒ…å«: å…¶ä»– Service çš„é‡è¯•ï¼ˆåç»­ä»»åŠ¡ï¼‰

---

## 2. æŠ€æœ¯è§„æ ¼

### æ¶‰åŠæ–‡ä»¶

| æ–‡ä»¶ | æ“ä½œ | è¯´æ˜ |
|------|------|------|
| `src/services/email_service.py` | ä¿®æ”¹ | æ·»åŠ é‡è¯•è£…é¥°å™¨ |
| `tests/test_email_service.py` | ä¿®æ”¹ | æ·»åŠ é‡è¯•æµ‹è¯• |

### æ¥å£å®šä¹‰

```python
# å¯ä»¥ä½¿ç”¨è£…é¥°å™¨æ¨¡å¼
from functools import wraps
import time

def with_retry(
    max_retries: int = 3,
    delay: float = 1.0,
    backoff: float = 2.0,
    exceptions: tuple = (Exception,),
):
    """
    ä¸ºå‡½æ•°æ·»åŠ é‡è¯•æœºåˆ¶çš„è£…é¥°å™¨ã€‚
    
    Args:
        max_retries: æœ€å¤§é‡è¯•æ¬¡æ•°
        delay: åˆå§‹å»¶è¿Ÿç§’æ•°
        backoff: å»¶è¿Ÿå¢é•¿å€æ•°
        exceptions: éœ€è¦é‡è¯•çš„å¼‚å¸¸ç±»å‹
    
    Example:
        @with_retry(max_retries=3, delay=1.0)
        def call_api():
            ...
    """
    def decorator(func):
        @wraps(func)
        def wrapper(*args, **kwargs):
            last_exception = None
            current_delay = delay
            
            for attempt in range(max_retries + 1):
                try:
                    return func(*args, **kwargs)
                except exceptions as e:
                    last_exception = e
                    if attempt < max_retries:
                        print(f"Retry {attempt + 1}/{max_retries} after {current_delay}s: {e}")
                        time.sleep(current_delay)
                        current_delay *= backoff
            
            raise last_exception
        return wrapper
    return decorator
```

### ä¾èµ–å…³ç³»

- ä¾èµ–: æ— æ–°ä¾èµ–
- è¢«ä¾èµ–: æ— 

---

## 3. éªŒæ”¶æ ‡å‡†

### åŠŸèƒ½æµ‹è¯•

- [ ] æ­£å¸¸æƒ…å†µ: LLM é¦–æ¬¡è°ƒç”¨æˆåŠŸï¼Œä¸è§¦å‘é‡è¯•
- [ ] é‡è¯•æˆåŠŸ: ç¬¬ä¸€æ¬¡å¤±è´¥ï¼Œç¬¬äºŒæ¬¡æˆåŠŸï¼Œè¿”å›æ­£ç¡®ç»“æœ
- [ ] é‡è¯•è€—å°½: ä¸‰æ¬¡éƒ½å¤±è´¥ï¼ŒæŠ›å‡º `EmailServiceError`
- [ ] å»¶è¿Ÿæ­£ç¡®: é‡è¯•é—´éš”æŒ‰ backoff å¢é•¿

### ä»£ç è´¨é‡

- [ ] è£…é¥°å™¨æœ‰å®Œæ•´ docstring
- [ ] ç±»å‹æ ‡æ³¨å®Œæ•´
- [ ] æµ‹è¯•è¦†ç›–ç‡ > 80%

### æ–‡æ¡£

- [ ] æ›´æ–°æœ¬ä»»åŠ¡æ–‡æ¡£çš„å®ç°è®°å½•
- [ ] PR æè¿°åŒ…å«æµ‹è¯•ç»“æœæˆªå›¾

---

## 4. è®¾è®¡æ–¹æ¡ˆ (å®ä¹ ç”Ÿå¡«å†™)

### å®ç°æ€è·¯

> åœ¨è¿™é‡Œæè¿°ä½ æ‰“ç®—å¦‚ä½•å®ç°...

### å…³é”®å†³ç­–

> åˆ—å‡ºä»»ä½•éœ€è¦åšçš„æŠ€æœ¯é€‰æ‹©...

### Senior å®¡æ‰¹

- [ ] è®¾è®¡æ–¹æ¡ˆå·²å®¡æ‰¹ (Senior ç­¾å: _______  æ—¥æœŸ: _______ )

---

## 5. å®ç°è®°å½• (å®ä¹ ç”Ÿå¡«å†™)

### å¼€å‘æ—¥å¿—

| æ—¥æœŸ | è¿›åº¦ | å¤‡æ³¨ |
|------|------|------|

### é‡åˆ°çš„é—®é¢˜

ï¼ˆå¼€å‘è¿‡ç¨‹ä¸­è®°å½•ï¼‰

### PR é“¾æ¥

- PR #XX: [æ ‡é¢˜](é“¾æ¥)

---

## 6. Review è®°å½• (Senior å¡«å†™)

### ä»£ç å®¡æŸ¥

- [ ] ä»£ç ç¬¦åˆè§„èŒƒ
- [ ] æµ‹è¯•å……åˆ†
- [ ] æ— å®‰å…¨é£é™©

### åé¦ˆ

> Senior çš„ä¿®æ”¹å»ºè®®...

### æœ€ç»ˆå®¡æ‰¹

- [ ] âœ… å·²åˆå¹¶ (æ—¥æœŸ: _______) 
- [ ] âŒ éœ€è¦è¿”å·¥ (åŸå› : _______)
